import{a as B}from"./chunk-H2QKMEBL.js";import{a as W}from"./chunk-PNRCHS3F.js";import{b as N,c as H,f as R,i as F,j,k as L,n as O}from"./chunk-GT7YRUEU.js";import{Ca as I,Lb as q,Ra as P,Sa as T,Ua as V,Va as J,X as g,Xa as t,Y as x,Ya as e,Z as v,Za as S,_ as b,bb as E,cb as _,db as c,ea as h,hb as M,ib as n,jb as y,kb as m,mb as C,nb as w,ob as D,sa as l,wa as A}from"./chunk-5P4XIA3I.js";var G=(u,o)=>o.id;function U(u,o){if(u&1){let i=E();t(0,"div",8)(1,"div",26)(2,"p",27),v(),t(3,"svg",28),S(4,"path",29),e(),n(5," Vous n'avez pas encore point\xE9 aujourd'hui "),e()(),b(),t(6,"button",30),_("click",function(){g(i);let a=c();return x(a.pointageArrivee())}),v(),t(7,"svg",31),S(8,"path",32),e(),n(9," Pointer l'arriv\xE9e "),e()()}}function Y(u,o){if(u&1){let i=E();t(0,"div",8)(1,"div",33)(2,"p",34),v(),t(3,"svg",28),S(4,"path",35),e(),n(5),e(),b(),t(6,"p",36),n(7),e()(),t(8,"button",37),_("click",function(){g(i);let a=c();return x(a.pointageDepart())}),v(),t(9,"svg",31),S(10,"path",38),e(),n(11," Pointer le d\xE9part "),e()()}if(u&2){let i,r=c();l(5),m(" Arriv\xE9e point\xE9e \xE0 ",(i=r.pointageJour())==null?null:i.heureArrivee," "),l(2),m(" Temps de travail actuel: ",r.calculerTempsTravailActuel()," ")}}function K(u,o){if(u&1&&(t(0,"div",8)(1,"div",39)(2,"p",40),v(),t(3,"svg",28),S(4,"path",41),e(),n(5," Pointage termin\xE9 pour aujourd'hui "),e(),b(),t(6,"div",42)(7,"p"),n(8),e(),t(9,"p"),n(10),e(),t(11,"p"),n(12),e()()(),t(13,"div"),n(14),e()()),u&2){let i,r,a,s,p,d=c();l(8),m("Arriv\xE9e: ",(i=d.pointageJour())==null?null:i.heureArrivee),l(2),m("D\xE9part: ",(r=d.pointageJour())==null?null:r.heureDepart),l(2),m("Temps travaill\xE9: ",(a=d.pointageJour())==null?null:a.heuresTravaillees,"h"),l(),M(d.getStatutColor(((s=d.pointageJour())==null?null:s.statut)||"")),l(),m(" ",d.getStatutLabel(((p=d.pointageJour())==null?null:p.statut)||"")," ")}}function Q(u,o){if(u&1){let i=E();t(0,"div",43)(1,"div")(2,"input",44),D("ngModelChange",function(a){g(i);let s=c();return w(s.dateDebut,a)||(s.dateDebut=a),x(a)}),e()(),t(3,"div")(4,"input",44),D("ngModelChange",function(a){g(i);let s=c();return w(s.dateFin,a)||(s.dateFin=a),x(a)}),e()()(),t(5,"button",45),_("click",function(){g(i);let a=c();return x(a.chargerHistorique())}),n(6," Charger "),e()}if(u&2){let i=c();l(2),C("ngModel",i.dateDebut),l(2),C("ngModel",i.dateFin)}}function X(u,o){if(u&1&&(t(0,"tr",25)(1,"td",46),n(2),e(),t(3,"td",46),n(4),e(),t(5,"td",46),n(6),e(),t(7,"td",46),n(8),e(),t(9,"td",47)(10,"span"),n(11),e()()()),u&2){let i=o.$implicit,r=c();l(2),m(" ",r.formatDate(i.date)," "),l(2),m(" ",i.heureArrivee||"-"," "),l(2),m(" ",i.heureDepart||"-"," "),l(2),m(" ",i.heuresTravaillees||0,"h "),l(2),M(r.getStatutClass(i.statut)),l(),m(" ",r.getStatutLabel(i.statut)," ")}}function Z(u,o){u&1&&(t(0,"tr")(1,"td",48),n(2," Aucun pointage trouv\xE9 pour cette p\xE9riode "),e()())}var z=class u{constructor(o,i){this.pointageService=o;this.authService=i}pointageJour=h(null);historiquePointages=h([]);statistiques=h(null);heureActuelle=h("");dateActuelle=h("");periodeSelectionnee="mois";dateDebut="";dateFin="";ngOnInit(){this.mettreAJourHeure(),this.chargerDonnees(),setInterval(()=>this.mettreAJourHeure(),1e3)}mettreAJourHeure(){let o=new Date;this.heureActuelle.set(o.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit",second:"2-digit"})),this.dateActuelle.set(o.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}))}chargerDonnees(){let o=this.authService.getCurrentUser();if(o){this.pointageService.getPointagesDuJour(o.id).subscribe(r=>{this.pointageJour.set(r)});let i=new Date().toISOString().slice(0,7);this.pointageService.getStatistiquesPointage(o.id,i).subscribe(r=>{this.statistiques.set(r)}),this.chargerHistorique()}}chargerHistorique(){let o=this.authService.getCurrentUser();if(!o)return;let i,r,a=new Date;switch(this.periodeSelectionnee){case"semaine":let s=new Date(a);s.setDate(a.getDate()-a.getDay()),i=s.toISOString().split("T")[0],r=a.toISOString().split("T")[0];break;case"mois":i=new Date(a.getFullYear(),a.getMonth(),1).toISOString().split("T")[0],r=a.toISOString().split("T")[0];break;case"trimestre":let p=Math.floor(a.getMonth()/3);i=new Date(a.getFullYear(),p*3,1).toISOString().split("T")[0],r=a.toISOString().split("T")[0];break;case"personnalisee":i=this.dateDebut,r=this.dateFin;break;default:return}i&&r&&this.pointageService.getPointagesPeriode(o.id,i,r).subscribe(s=>{this.historiquePointages.set(s.sort((p,d)=>new Date(d.date).getTime()-new Date(p.date).getTime()))})}pointageArrivee(){let o=this.authService.getCurrentUser();o&&this.pointageService.enregistrerArrivee(o.id).subscribe({next:i=>{this.pointageJour.set(i),this.chargerDonnees()},error:i=>{console.error("Erreur pointage arriv\xE9e:",i)}})}pointageDepart(){let o=this.authService.getCurrentUser();o&&this.pointageService.enregistrerDepart(o.id).subscribe({next:i=>{this.pointageJour.set(i),this.chargerDonnees()},error:i=>{console.error("Erreur pointage d\xE9part:",i)}})}calculerTempsTravailActuel(){let o=this.pointageJour();if(o?.heureArrivee){let[i,r]=o.heureArrivee.split(":").map(Number),a=new Date,s=a.getHours()+a.getMinutes()/60,p=i+r/60,d=s-p,f=Math.floor(d),k=Math.round((d-f)*60);return`${f}h${k>0?` ${k}min`:""}`}return"0h"}getStatutClass(o){switch(o){case"PRESENT":return"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800";case"RETARD":return"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800";case"ABSENT":return"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800";default:return"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800"}}getStatutColor(o){switch(o){case"PRESENT":return"inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-green-100 text-green-800";case"RETARD":return"inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-yellow-100 text-yellow-800";case"ABSENT":return"inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-red-100 text-red-800";default:return"inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-gray-100 text-gray-800"}}getStatutLabel(o){switch(o){case"PRESENT":return"Pr\xE9sent";case"RETARD":return"Retard";case"ABSENT":return"Absent";case"PARTIEL":return"Partiel";default:return"Non d\xE9fini"}}formatDate(o){return new Date(o).toLocaleDateString("fr-FR")}static \u0275fac=function(i){return new(i||u)(A(B),A(W))};static \u0275cmp=I({type:u,selectors:[["app-pointage"]],decls:80,vars:10,consts:[[1,"space-y-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"card"],[1,"text-lg","font-semibold","text-gray-900","mb-4"],[1,"text-center"],[1,"text-3xl","font-bold","text-gray-900","mb-2"],[1,"text-sm","text-gray-500","mb-6"],[1,"space-y-4"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"flex","justify-between","items-center"],[1,"font-semibold"],[1,"font-semibold","text-yellow-600"],[1,"font-semibold","text-red-600"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"input-field",3,"ngModelChange","ngModel"],["value","semaine"],["value","mois"],["value","trimestre"],["value","personnalisee"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],[1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],[1,"hover:bg-gray-50"],[1,"p-4","bg-yellow-50","rounded-lg","border","border-yellow-200"],[1,"text-yellow-800","text-sm"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"btn-primary","text-lg","px-8","py-3",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"p-4","bg-green-50","rounded-lg","border","border-green-200"],[1,"text-green-800","text-sm","font-medium"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"text-green-700","text-xs","mt-1"],[1,"btn-secondary","text-lg","px-8","py-3",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-6 0v-1m6 0H9"],[1,"p-4","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"text-blue-800","text-sm","font-medium"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"mt-2","space-y-1","text-blue-700","text-xs"],[1,"grid","grid-cols-2","gap-3"],["type","date",1,"input-field",3,"ngModelChange","ngModel"],[1,"btn-primary","w-full",3,"click"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-900"],[1,"px-6","py-4","whitespace-nowrap"],["colspan","5",1,"px-6","py-4","text-center","text-gray-500"]],template:function(i,r){if(i&1&&(t(0,"div",0)(1,"div")(2,"h1",1),n(3,"Syst\xE8me de pointage"),e(),t(4,"p",2),n(5,"G\xE9rez vos heures de travail et consultez votre historique"),e()(),t(6,"div",3)(7,"h2",4),n(8,"Pointage d'aujourd'hui"),e(),t(9,"div",5)(10,"div",6),n(11),e(),t(12,"div",7),n(13),e(),P(14,U,10,0,"div",8)(15,Y,12,2,"div",8)(16,K,15,6,"div",8),e()(),t(17,"div",9)(18,"div",3)(19,"h2",4),n(20,"Ce mois-ci"),e(),t(21,"div",8)(22,"div",10)(23,"span",2),n(24,"Jours travaill\xE9s"),e(),t(25,"span",11),n(26),e()(),t(27,"div",10)(28,"span",2),n(29,"Heures totales"),e(),t(30,"span",11),n(31),e()(),t(32,"div",10)(33,"span",2),n(34,"Retards"),e(),t(35,"span",12),n(36),e()(),t(37,"div",10)(38,"span",2),n(39,"Absences"),e(),t(40,"span",13),n(41),e()()()(),t(42,"div",3)(43,"h2",4),n(44,"Consulter l'historique"),e(),t(45,"div",8)(46,"div")(47,"label",14),n(48," P\xE9riode "),e(),t(49,"select",15),D("ngModelChange",function(s){return w(r.periodeSelectionnee,s)||(r.periodeSelectionnee=s),s}),_("ngModelChange",function(){return r.chargerHistorique()}),t(50,"option",16),n(51,"Cette semaine"),e(),t(52,"option",17),n(53,"Ce mois"),e(),t(54,"option",18),n(55,"Ce trimestre"),e(),t(56,"option",19),n(57,"P\xE9riode personnalis\xE9e"),e()()(),P(58,Q,7,2),e()()(),t(59,"div",3)(60,"h2",4),n(61,"Historique des pointages"),e(),t(62,"div",20)(63,"table",21)(64,"thead",22)(65,"tr")(66,"th",23),n(67,"Date"),e(),t(68,"th",23),n(69,"Arriv\xE9e"),e(),t(70,"th",23),n(71,"D\xE9part"),e(),t(72,"th",23),n(73,"Heures"),e(),t(74,"th",23),n(75,"Statut"),e()()(),t(76,"tbody",24),V(77,X,12,7,"tr",25,G,!1,Z,3,0,"tr"),e()()()()()),i&2){let a,s,p,d,f;l(11),m(" ",r.heureActuelle()," "),l(2),m(" ",r.dateActuelle()," "),l(),T((a=r.pointageJour())!=null&&a.heureArrivee?(a=r.pointageJour())!=null&&a.heureDepart?16:15:14),l(12),y(((s=r.statistiques())==null?null:s.totalJours)||0),l(5),m("",((p=r.statistiques())==null?null:p.totalHeures)||0,"h"),l(5),y(((d=r.statistiques())==null?null:d.joursRetard)||0),l(5),y(((f=r.statistiques())==null?null:f.joursAbsents)||0),l(8),C("ngModel",r.periodeSelectionnee),l(9),T(r.periodeSelectionnee==="personnalisee"?58:-1),l(19),J(r.historiquePointages())}},dependencies:[q,O,j,L,N,F,H,R],encapsulation:2})};export{z as PointageComponent};
